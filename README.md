
# Manual Process for Updating Kubernetes Secrets for SSL Certificates

This document provides an alternative method to update SSL certificates in Kubernetes in case the GitHub SSL renewal workflow fails. Follow the steps below to manually update certificates in the Kubernetes cluster.

## Steps:

1. **Login to GCP Console**
   - Access the respective environment (Production/Dev/Staging) using either:
     - **kubectl** command line tool.
     - **Lens IDE** for easier visualization.

   ```bash
   # Example for connecting via kubectl:
   gcloud container clusters get-credentials <cluster-name> --zone <zone> --project <project-id>
   ```

2. **Identify the Respective Ingress/Deployment**
   - Find the related **Ingress** or **Deployment** manifest file responsible for serving the application.
   - Review the **TLS** section of the **Ingress** or related **ConfigMap** to determine the certificate secret name.

   ```yaml
   tls:
     - hosts:
         - example.com
       secretName: tls-cert-secret
   ```

3. **Check the TLS Certificate in Ingress/ConfigMap**
   - Navigate to the **Ingress** resource and inspect the certificate reference under the `tls` section.
   - Note the `secretName`, which corresponds to the secret holding the certificate.

   ```bash
   kubectl get ingress <ingress-name> -n <namespace> -o yaml | grep tls
   ```

4. **Access the Corresponding Secret**
   - Once you have identified the **secretName**, locate it in the Kubernetes cluster:

   ```bash
   kubectl get secret tls-cert-secret -n <namespace>
   ```

5. **Retrieve or Generate the New Certificate**
   - Obtain the renewed SSL certificate by:
     - Running the **acme script**.
     - Fetching the certificate generated by the GitHub SSL renewal workflow (if available).

6. **Update the Secret in Kubernetes**
   - Update the Kubernetes TLS secret with the new certificate:

   ```bash
   kubectl delete secret tls-cert-secret -n <namespace>
   kubectl create secret tls tls-cert-secret --cert=/path/to/cert.crt --key=/path/to/cert.key -n <namespace>
   ```

7. **Restart the Deployment (if necessary)**
   - If the certificate is used in a **Deployment**, restart the associated pods to apply the new certificate:

   ```bash
   kubectl rollout restart deployment <deployment-name> -n <namespace>
   ```

---

## Example Screenshot

Refer to the attached screenshot showing the process in Lens IDE.

---

## Quick Reference Commands

1. **Connect to GCP Kubernetes Cluster:**
   ```bash
   gcloud container clusters get-credentials <cluster-name> --zone <zone> --project <project-id>
   ```

2. **Check Ingress TLS Secret Name:**
   ```bash
   kubectl get ingress <ingress-name> -n <namespace> -o yaml | grep tls
   ```

3. **Get Existing Secret Information:**
   ```bash
   kubectl get secret tls-cert-secret -n <namespace>
   ```

4. **Update the Secret with New Certificate:**
   ```bash
   kubectl delete secret tls-cert-secret -n <namespace>
   kubectl create secret tls tls-cert-secret --cert=/path/to/cert.crt --key=/path/to/cert.key -n <namespace>
   ```

5. **Restart Deployment (if required):**
   ```bash
   kubectl rollout restart deployment <deployment-name> -n <namespace>
   ```
