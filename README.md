# Manual Process for Updating Kubernetes Secrets for SSL Certificates

This document provides an alternative method to update SSL certificates in Kubernetes in case the GitHub SSL renewal workflow fails. Follow the steps below to manually update certificates in the Kubernetes cluster.

## Steps:

1. **Login to GCP Console**
   - Access the respective environment (Production/Dev/Staging) using either:
     - **kubectl** command line tool.
     - **Lens IDE** for easier visualization.

   ```bash
   # Example for connecting via kubectl:
   gcloud container clusters get-credentials <cluster-name> --zone <zone> --project <project-id>
   ```
   ![image](https://github.com/user-attachments/assets/dc1b8457-8bd8-491e-81ab-f83ff589cd08)

2. **Identify the Respective Ingress/Deployment**
   - Find the related **Ingress**, **Deployment** and **Service** manifest file responsible for serving the application.
   - Review the **TLS** section of the **Ingress** or related **ConfigMap** to determine the certificate secret name.

   Ex - Deployment: 
   ![image](https://github.com/user-attachments/assets/91d31161-7257-4adb-a9b0-c5b2b321bedc)

   Ex - Ingress/Service:

   ![image](https://github.com/user-attachments/assets/32e7de2a-abaa-47a9-9f40-e4ac14459bbe)



4. **Check the TLS Certificate in Ingress/ConfigMap**
   - Navigate to the **Ingress** resource and inspect the certificate reference under the `tls` section.
   - Note the `secretName`, which corresponds to the secret holding the certificate.

   ```yaml
      spec:
        tls:
          - hosts:
              - www.wavi.ng
            secretName: www.wavi.ng
          - hosts:
              - wavi.ng
            secretName: wavi.ng
   ```

5. **Access the Corresponding Secret**
   - Once you have identified the **secretName**, locate it in the Kubernetes cluster:
   
   Lens:
   
   ![image](https://github.com/user-attachments/assets/1ae9015d-d51d-4349-ade8-e0b802c5abb5)

   From CLI:
   ```bash
   kubectl get secret tls-cert-secret -n <namespace>
   ```

7. **Retrieve or Generate the New Certificate**
   - Obtain the renewed SSL certificate by:
     - Running the **acme script**.
     - Fetching the certificate generated by the GitHub SSL renewal workflow (if available).

8. **Update the Secret in Kubernetes**
   - Update the Kubernetes TLS secret with the new certificate:

   Lens:
      ![image](https://github.com/user-attachments/assets/db517305-d73e-4921-98ba-5cc326ca68fe)

   From CLI:

   ```bash
   kubectl delete secret tls-cert-secret -n <namespace>
   kubectl create secret tls tls-cert-secret --cert=/path/to/cert.crt --key=/path/to/cert.key -n <namespace>
   ```

9. **Restart the Deployment (if necessary)**
   - If the certificate is used in a **Deployment**, restart the associated pods to apply the new certificate:
   From CLI:
   ```bash
   kubectl rollout restart deployment <deployment-name> -n <namespace>
   ```
  
